
<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <title>Aubade_Blog</title>
        <meta name="author" content="Terrance">
        <meta name="description" content="Persisting will immortalizes freedom.">
        <meta name="keywords" content="">
        <meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=0">
        <link rel="icon" href="/images/OIP.jpg">
        <script src="https://cdn.staticfile.org/vue/3.2.45/vue.global.prod.min.js"></script>
        <script src="https://cdn.staticfile.org/highlight.js/11.7.0/highlight.min.js"></script>
        <link rel="stylesheet" href="https://cdn.staticfile.org/highlight.js/11.7.0/styles/github.min.css">
        <link rel="stylesheet" href="https://cdn.staticfile.org/font-awesome/6.2.1/css/all.min.css">
        
        <script src="https://polyfill.io/v3/polyfill.min.js?features=default"></script>
        
        
        <script src="https://cdn.staticfile.org/KaTeX/0.16.4/katex.min.js"></script>
        <script src="https://cdn.staticfile.org/KaTeX/0.16.4/contrib/auto-render.min.js"></script>
        <link rel="stylesheet" href="https://cdn.staticfile.org/KaTeX/0.16.4/katex.min.css">
        
        
        <link rel="stylesheet" href="/css/fonts.min.css">
        <link rel="stylesheet" href="/css/particlex.css">
    <meta name="generator" content="Hexo 6.3.0"></head>
    <body>
        <div id="loading" style="height: 100vh; width: 100vw; left: 0; top: 0; position: fixed; display: flex; z-index: 2147483647; background: #fff; transition: opacity 0.3s ease-out; -webkit-user-select: none; -moz-user-select: none; -ms-user-select: none; user-select: none; pointer-events: none">
    <div style="width: 50vmin; height: 50vmin; margin: auto; padding: 50px; border-radius: 50%; display: flex; border: solid 10px #a3ddfb">
        <div style="margin: auto; text-align: center">
            <h2>LOADING</h2>
            <p>加载过慢请开启缓存，浏览器默认开启</p>
            <img src="/images/loading.gif" style="height: 50px; border-radius: 0">
        </div>
    </div>
</div>

        <div id="layout">
            <transition name="into">
            <div id="main" v-show="showpage" style="display: -not-none">
                <nav id="menu">
    <div class="desktop-menu">
        <a class="title" href="/">
            <span>AUBADE_BLOG</span>
        </a>
        
        <a href="/">
            <i class="fa-solid fa-house fa-fw"></i>
            <span>&ensp;Home</span>
        </a>
        
        <a href="/about">
            <i class="fa-solid fa-id-card fa-fw"></i>
            <span>&ensp;About</span>
        </a>
        
        <a href="/archives">
            <i class="fa-solid fa-box-archive fa-fw"></i>
            <span>&ensp;Archives</span>
        </a>
        
        <a href="/categories">
            <i class="fa-solid fa-bookmark fa-fw"></i>
            <span>&ensp;Categories</span>
        </a>
        
        <a href="/tags">
            <i class="fa-solid fa-tags fa-fw"></i>
            <span>&ensp;Tags</span>
        </a>
        
    </div>
    <div :class="&quot;phone-menu &quot; + menushow" id="phone-menu">
        <div class="curtain" @click="menushow = !menushow" v-show="menushow"></div>
        <div class="title" @click="menushow = !menushow">
            <i class="fa-solid fa-bars fa-fw"></i>
            <span>&emsp;AUBADE_BLOG</span>
        </div>
        <transition name="slide">
        <div class="items" v-show="menushow">
            
            <a href="/">
                <div class="item">
                    <div style="min-width: 20px; max-width: 50px; width: 10%">
                        <i class="fa-solid fa-house fa-fw"></i>
                    </div>
                    <div style="min-width: 100px; max-width: 150%; width: 20%">Home</div>
                </div>
            </a>
            
            <a href="/about">
                <div class="item">
                    <div style="min-width: 20px; max-width: 50px; width: 10%">
                        <i class="fa-solid fa-id-card fa-fw"></i>
                    </div>
                    <div style="min-width: 100px; max-width: 150%; width: 20%">About</div>
                </div>
            </a>
            
            <a href="/archives">
                <div class="item">
                    <div style="min-width: 20px; max-width: 50px; width: 10%">
                        <i class="fa-solid fa-box-archive fa-fw"></i>
                    </div>
                    <div style="min-width: 100px; max-width: 150%; width: 20%">Archives</div>
                </div>
            </a>
            
            <a href="/categories">
                <div class="item">
                    <div style="min-width: 20px; max-width: 50px; width: 10%">
                        <i class="fa-solid fa-bookmark fa-fw"></i>
                    </div>
                    <div style="min-width: 100px; max-width: 150%; width: 20%">Categories</div>
                </div>
            </a>
            
            <a href="/tags">
                <div class="item">
                    <div style="min-width: 20px; max-width: 50px; width: 10%">
                        <i class="fa-solid fa-tags fa-fw"></i>
                    </div>
                    <div style="min-width: 100px; max-width: 150%; width: 20%">Tags</div>
                </div>
            </a>
            
        </div>
        </transition>
    </div>
</nav>

                <div id="home-head">
    <div id="home-background" style="background-image: url(/images/bk.jfif)"></div>
    
    <div id="home-info" @click="homeclick">
        <span class="loop"></span>
        <span class="loop"></span>
        <span class="loop"></span>
        <span class="loop"></span>
        <span class="info">
            <div class="wrap">
                <h1>Aubade_Blog</h1>
                <h3></h3>
                <h5>Persisting will immortalizes freedom.</h5>
            </div>
        </span>
    </div>
    
</div>
<div id="home-posts-wrap" class="">
    <div id="home-posts">
        <div id="posts">
            

<div class="post">
    <a href="/2023/03/04/COMP310-SynchroP/">
        <h2 class="post-title">COMP310_SynchroP</h2>
    </a>
    <div class="category-and-date">
        
        <span class="category">
            <a href="/categories/Lecture-notes/">
                <span class="icon">
                    <i class="fa-solid fa-bookmark fa-fw"></i>
                </span>
                Lecture notes
            </a>
        </span>
        
        <span class="date">
            <span class="icon">
                <i class="fa-solid fa-calendar fa-fw"></i>
            </span>
            2023/3/4
        </span>
        
        
    </div>
    <div class="description">
        <div class="content" v-pre>
            
            <h3 id="Synchronization-Primitives-同步原语"><a href="#Synchronization-Primitives-同步原语" class="headerlink" title="Synchronization Primitives 同步原语"></a>Synchronization Primitives 同步原语</h3><h4 id="Concurrency"><a href="#Concurrency" class="headerlink" title="Concurrency"></a><strong>Concurrency</strong></h4><h4 id="Purpose"><a href="#Purpose" class="headerlink" title="Purpose"></a><strong>Purpose</strong></h4><p>The motivation for leading into concurrency:</p>
<ul>
<li>CPU trend: Same speed, multiple cores &lt;- destined by Moore’s Law</li>
<li>Goal: write applications fully utilize many cores</li>
</ul>
<h5 id="Option"><a href="#Option" class="headerlink" title="Option:"></a><strong>Option:</strong></h5><ul>
<li>Multiprocess<ul>
<li>apps based on many communicating process</li>
<li>communicate through message passing -&gt; no shared memeory</li>
<li>Pros: One process crashing not affect other processes</li>
<li>Cons: High communication overloads &amp; Expensive context switching</li>
</ul>
</li>
<li>Multithread  <ul>
<li>multiple threads in a process</li>
<li>communicate through memory sharing(shared address space)</li>
<li>Pros: High efficiency</li>
<li>Cons: One crash whole crash</li>
</ul>
</li>
</ul>
<h5 id="Non-Determinism"><a href="#Non-Determinism" class="headerlink" title="Non-Determinism:"></a><strong>Non-Determinism:</strong></h5><ul>
<li>Concurrency leads to non-deterministic results -&gt; depends on CPU scheduler<ul>
<li>Different results with same inputs</li>
<li>Race Conditions</li>
</ul>
</li>
</ul>
<h4 id="Thread"><a href="#Thread" class="headerlink" title="Thread"></a><strong>Thread</strong></h4><h5 id="Def"><a href="#Def" class="headerlink" title="Def"></a><strong>Def</strong></h5><p>The smallest controllable unit of the OS. The essential part of thread is data(memory) sharing.</p>
<h5 id="Diiference-to-Process"><a href="#Diiference-to-Process" class="headerlink" title="Diiference to Process"></a><strong>Diiference to Process</strong></h5><ul>
<li>Processes provide seperation -&gt; suitable for coarse interaction</li>
<li>Threads do not provide seperation -&gt; suitable for tighter integration</li>
</ul>
<h5 id="Shared-Data"><a href="#Shared-Data" class="headerlink" title="Shared Data"></a><strong>Shared Data</strong></h5><ul>
<li>Advantage: Many threads can read&#x2F;write it</li>
<li>Dis: Data racing</li>
</ul>
<h6 id="Dara-Racing"><a href="#Dara-Racing" class="headerlink" title="Dara Racing"></a><strong>Dara Racing</strong></h6><ul>
<li>Unwanted access to shared data</li>
<li>result of interleaving of thread executions</li>
<li>program must be correct for all interleavings</li>
</ul>
<p>The essence of data racing is from the non-determinism of concurrency.  </p>
<h4 id="Synchronization-Primitives"><a href="#Synchronization-Primitives" class="headerlink" title="Synchronization Primitives:"></a><strong>Synchronization Primitives:</strong></h4><p><em>implemented via hardware support in kernel mode</em></p>
<table><tr><td>Software</td><td>Hardware</td></tr>
<tr><td><ul><li>Monitors</li><li>Semaphores</li><li>Locks(mutex)</li><li>Condition Variables</li></ul></td><td><ul><li>Loads</li><li>Stores</li><li>Test&Set</li><li>Disable Interrupts</li></ul></td></tr></table>

<h5 id="Atomization-Mutual-Exclusion"><a href="#Atomization-Mutual-Exclusion" class="headerlink" title="Atomization(Mutual Exclusion)"></a><strong>Atomization(Mutual Exclusion)</strong></h5><p>The aforementioned problem generates the following basic approach to multithreading with the solution:<br><em>The core is atomization(mutual exclusion of critical section).</em> </p>
<ol>
<li>Divide work among multiple threads</li>
<li>Shared data -&gt; Put shared data access in <u>critical section</u>(<strong>atomization</strong>)</li>
</ol>
<h6 id="Purpose-1"><a href="#Purpose-1" class="headerlink" title="Purpose:"></a><strong>Purpose:</strong></h6><p>Prevents simultaneous access to a shared resource(memory region, …);solving critical section problem.</p>
<p>We need library support(pthreads) to achieve mutual exclusion.  </p>
<blockquote>
<p><strong>POSIX Thread Libraries</strong></p>
<ul>
<li>Thread API for C&#x2F;C++</li>
<li>User-level library:<ul>
<li>#include&lt;pthread.h&gt;</li>
<li>Compile and link with <code>-pthread</code></li>
</ul>
</li>
<li>Support for thread creation, termination, synchronization</li>
</ul>
<p>pthread_create();  pthread_exit(); pthread_join()</p>
</blockquote>
<blockquote>
<p><strong>Pthread_Locks:</strong><br>##Notice that the lock itself is a shared variable<br>Pthread_mutex_lock(mutex)<br><em>If lock is held by another thread, block; otherwise, acquire the lock and proceed.</em><br><em><u>This actually means the condition of the lock is always checking. System resource is in use.</u></em><br>Pthread_mutex_unlock(mutex)<br><em>Release the lock</em></p>
</blockquote>
<h6 id="Deadlocks"><a href="#Deadlocks" class="headerlink" title="Deadlocks"></a><strong>Deadlocks</strong></h6><p>Threads are stuck waiting for blocked resources and no amount of retry will help.</p>
<h5 id="Condition-Variables"><a href="#Condition-Variables" class="headerlink" title="Condition Variables"></a><strong>Condition Variables</strong></h5><p>Conditional Variable is a sychronization primitive which is a bit complex than lock.</p>
<ul>
<li>Used when thread A needs to wait for an event done by thread B</li>
<li>A waits until the certain condition is true<ol>
<li>Test the condition</li>
<li>If the condition is not true, call<br> <code>pthread_cond_wait()</code> -&gt; causes A be blocked until the condition is true</li>
</ol>
</li>
<li>At some point B makes the condition true<ol>
<li>Then B calls <code>pthread_cond_signal()</code> -&gt;unblocks A</li>
</ol>
</li>
</ul>
<blockquote>
<p><em>Condition variable is a shared data, so introduce lock(mutex) here.</em></p>
</blockquote>
<blockquote>
<p><strong>Conditional Variables Interface</strong><br>pthread_cond_init(pthread_cond_t *cv, pthread_condattr_t *cattr)  </p>
<ul>
<li>Initialize the conditional variable, cattr can be null</li>
</ul>
<p>pthread_cond_wait(pthread_cond_t *cv, pthread_mutex_t *mutex)</p>
<ul>
<li>Block thread until condition is treu, and automatically unblock mutex</li>
</ul>
<p>pthread_cond_signal(pthread_cond_t *cv)</p>
<ul>
<li>Unblock one thread blocked by the conditional variable at random</li>
</ul>
<p>pthread_cond_broadcast(pthread_cond_t *cv)</p>
<ul>
<li>Unblock all threads blocked by the conditional variable</li>
</ul>
</blockquote>
<h6 id="Advantage"><a href="#Advantage" class="headerlink" title="Advantage"></a><strong>Advantage</strong></h6><p>A waits(sleeps) until a certain condition is true; CPU is not busy(not many resources is used).</p>
<h6 id="Two-Problems-for-Naive-Conditional-Variable-and-the-Solution"><a href="#Two-Problems-for-Naive-Conditional-Variable-and-the-Solution" class="headerlink" title="Two Problems for Naive Conditional Variable and the Solution"></a><strong>Two Problems for Naive Conditional Variable and the Solution</strong></h6><p>Check the lecture.</p>
<h4 id="Semaphores"><a href="#Semaphores" class="headerlink" title="Semaphores"></a><strong>Semaphores</strong></h4><p><em>#include&lt;semaphore.h&gt;</em><br>Semaphore is a shared, non-negative counter with two primary operations: wait(attempts to decrement the counter; blocks when the counter is 0),post&#x2F;signal(attempts to increment the counter).  </p>
<blockquote>
<p>Notice that the increment and decrement in semaphore are atomic.  </p>
</blockquote>
<blockquote>
<p>Semaphore value can be initialized upon creation to a positive value, or 0.</p>
</blockquote>
<h5 id="Uses"><a href="#Uses" class="headerlink" title="Uses"></a><strong>Uses</strong></h5><ul>
<li>Mutual exclusion:<br>A semaphore with its counter initialized to 1 is equivalent to a lock.</li>
<li>Bound the currency<br>Initialized to a larger value to bound the # of threads out of N to proceed.</li>
<li>Consumer-Producer Problem</li>
</ul>
<h5 id="interface"><a href="#interface" class="headerlink" title="interface"></a><strong>interface</strong></h5><blockquote>
<p>int sem_init(sem_t *sem,int pshared, unsigned value)<br>int sem_post(sem_t *sem)<br>int sem_wait(sem_t *sem)  </p>
</blockquote>

            
        </div>
    </div>
    <div class="post-tags">
        
        <span class="icon">
            <i class="fa-solid fa-tags fa-fw"></i>
        </span>
        
        
        <span class="tag">
            
            <a href="/tags/COMP310/" style="color: #00bcd4">
                COMP310
            </a>
        </span>
        
        <span class="tag">
            
            <a href="/tags/Lecture-notes/" style="color: #ff7d73">
                Lecture notes
            </a>
        </span>
        
        <span class="tag">
            
            <a href="/tags/OS/" style="color: #ff7d73">
                OS
            </a>
        </span>
        
    </div>
    <a href="/2023/03/04/COMP310-SynchroP/" class="go-post">阅读全文</a>
</div>

<div class="post">
    <a href="/2023/03/03/COMP310-multithreading/">
        <h2 class="post-title">COMP310_multithreading</h2>
    </a>
    <div class="category-and-date">
        
        <span class="category">
            <a href="/categories/Lecture-notes/">
                <span class="icon">
                    <i class="fa-solid fa-bookmark fa-fw"></i>
                </span>
                Lecture notes
            </a>
        </span>
        
        <span class="date">
            <span class="icon">
                <i class="fa-solid fa-calendar fa-fw"></i>
            </span>
            2023/3/3
        </span>
        
        
    </div>
    <div class="description">
        <div class="content" v-pre>
            
            <h2 id="Multithreading"><a href="#Multithreading" class="headerlink" title="Multithreading"></a><strong>Multithreading</strong></h2><h3 id="Purpose"><a href="#Purpose" class="headerlink" title="Purpose"></a><strong>Purpose</strong></h3><p>Still use web server as an example:  </p>
<ol>
<li>to ensure a certain level of security(for example, to guarantee the running code on the server would not disrupt anything), we may use multiprocess since process itself ensures a segregation</li>
<li>if security is guaranteed, multithread can be considered to its efficiency(by shared data)<br><em>Static data tend to be processed by process, dynamic by thread in server.</em></li>
</ol>
<h3 id="Basic-Approach-to-Multithreading"><a href="#Basic-Approach-to-Multithreading" class="headerlink" title="Basic Approach to Multithreading"></a><strong>Basic Approach to Multithreading</strong></h3><ol>
<li>Divide “work” anibf multiple threads(based on the property of work per se)</li>
<li>Shared data<ul>
<li>Only <code>global variables</code> and <code>heap</code> can be shared.</li>
<li>shared data accession by critical section</li>
</ul>
</li>
</ol>
<h3 id="Locking"><a href="#Locking" class="headerlink" title="Locking"></a><strong>Locking</strong></h3><p>For example, we may want to have a multithreading program compute the sum and products of elements in two arrays:</p>
<pre><code class="pseudo">main()&#123;
    int i, sum=0, prod=1
    for(i=0;i&lt;MAX_THREADS;i++)&#123;Pthread_create(...)&#125;
    for(i=0;i&lt;MAX_THREADS;i++)&#123;Pthread_join(...)&#125;
    printf(sum)
    printf(prod)
&#125;

Threadcode()&#123;
    int i,c
    for(i=my_min;i&lt;my_max;i++)&#123;
        c = a[i] * b[i]
        sum += c
        prod *= c
    &#125;
&#125;
</code></pre>
<blockquote>
<p><code>htop</code> can be used to check the status of the resources(CPU,memory…) </p>
</blockquote>
<p>We need to implement lock in thread to prevent data racing.<br>The naive way would be to implement biglock:</p>
<pre><code class="pseudo">Threadcode()&#123;
    int i,c
    for(i=my_min;i&lt;my_max;i++)&#123;
        c = a[i] * b[i]
        pthread_mutex_lock(biglock)
        sum += c
        prod *= c
        pthread_mutex_unlock(biglock)
    &#125;
&#125;
</code></pre>
<p>However, it reduces performance since <u>single lock inhibits parallelism</u>. Therefore, two approaches invented to deal with it:  </p>
<ol>
<li>Fine-grain locking:<ul>
<li>Multiple locks on individual pieces of shared data</li>
</ul>
</li>
<li>Privitization<ul>
<li>Make shared data accesses into private data access</li>
</ul>
</li>
</ol>
<h4 id="Fine-Grain-Locking"><a href="#Fine-Grain-Locking" class="headerlink" title="Fine-Grain Locking"></a><strong>Fine-Grain Locking</strong></h4><pre><code class="pseudo">Threadcode()&#123;
    int i,c
    for(i=my_min;i&lt;my_max;i++)&#123;
        c = a[i] * b[i]
        pthread_mutex_lock(sumlock)
        sum += c
        pthread_mutex_unlock(sumlock)
        pthread_mutex_lock(prodlock)
        prod *= c
        pthread_mutex_unlock(prodlock)
    &#125;
&#125;
## 2 lock accesses per thread, per iteration
</code></pre>
<h4 id="Privitization"><a href="#Privitization" class="headerlink" title="Privitization"></a><strong>Privitization</strong></h4><h5 id="Idea"><a href="#Idea" class="headerlink" title="Idea:"></a><strong>Idea:</strong></h5><p>For each thread define the local variables to represent the parts of the global variables; access the loop by the locals. Finally using the lock to the local variables.</p>
<pre><code class="pseudo">Threadcode()&#123;
    int i,c
    local_s =0
    local_p =1
    for(i=my_min;i&lt;my_max;i++)&#123;
        c = a[i] * b[i]
        local_s += c
        local_p *= c
    &#125;
        pthread_mutex_lock(sumlock)
        sum += local_s
        pthread_mutex_unlock(sumlock)
        pthread_mutex_lock(prodlock)
        prod *= local_p
        pthread_mutex_unlock(prodlock)
&#125;
## 2 lock accesses per thread, in total
</code></pre>
<h3 id="Producer-x2F-Consumer-Problem"><a href="#Producer-x2F-Consumer-Problem" class="headerlink" title="Producer&#x2F;Consumer Problem"></a><strong>Producer&#x2F;Consumer Problem</strong></h3><p>Arises when two or more threads communicate with each other.</p>
<h4 id="Def"><a href="#Def" class="headerlink" title="Def:"></a><strong>Def:</strong></h4><p>One shared bounded buffer with N entries. Requirements:  </p>
<ol>
<li>No production when N are all full(harder to deal since info may loss)</li>
<li>No consumption when no entry is full(easy to deal)</li>
<li>Access to the buffer is mutually exclusive(at a time only one process should be able to access the shared buffer and make changes to it)</li>
</ol>
<p><em>Locks cannot deal with it</em></p>
<h4 id="Solution-Semaphores"><a href="#Solution-Semaphores" class="headerlink" title="Solution: Semaphores"></a><strong>Solution: Semaphores</strong></h4><h5 id="Single-producer-and-consumer"><a href="#Single-producer-and-consumer" class="headerlink" title="Single producer and consumer"></a><strong>Single producer and consumer</strong></h5><p>Requires 2 semaphores:</p>
<ul>
<li>emptyBuffer: initalize to N -&gt; N empty buffers; producer can run N times first</li>
<li>fullBuffer: initialize to 0 -&gt; 0 full buffers; consumer can run 0 times first</li>
</ul>
<h5 id="Multiple-producers-and-consumers"><a href="#Multiple-producers-and-consumers" class="headerlink" title="Multiple producers and consumers"></a><strong>Multiple producers and consumers</strong></h5>
            
        </div>
    </div>
    <div class="post-tags">
        
        <span class="icon">
            <i class="fa-solid fa-tags fa-fw"></i>
        </span>
        
        
        <span class="tag">
            
            <a href="/tags/COMP310/" style="color: #03a9f4">
                COMP310
            </a>
        </span>
        
        <span class="tag">
            
            <a href="/tags/Lecture-notes/" style="color: #00a596">
                Lecture notes
            </a>
        </span>
        
    </div>
    <a href="/2023/03/03/COMP310-multithreading/" class="go-post">阅读全文</a>
</div>

<div class="post">
    <a href="/2023/03/03/COMP310-multiprocesscom/">
        <h2 class="post-title">COMP310_Multiprocess Communication</h2>
    </a>
    <div class="category-and-date">
        
        <span class="category">
            <a href="/categories/Lecture-Notes/">
                <span class="icon">
                    <i class="fa-solid fa-bookmark fa-fw"></i>
                </span>
                Lecture Notes
            </a>
        </span>
        
        <span class="date">
            <span class="icon">
                <i class="fa-solid fa-calendar fa-fw"></i>
            </span>
            2023/3/3
        </span>
        
        
    </div>
    <div class="description">
        <div class="content" v-pre>
            
            <h1 id="Multiprocess-Communication"><a href="#Multiprocess-Communication" class="headerlink" title="Multiprocess Communication"></a>Multiprocess Communication</h1><p><em>Some is not included.</em></p>
<h3 id="Purpose"><a href="#Purpose" class="headerlink" title="Purpose:"></a><strong>Purpose</strong>:</h3><p>Most times, the program(shell,compiler…) we have seen right now only represents one process, with the following structure:<br><code>Code, Globals, Heap, Stack, Registers, PC(Program Counter)  </code><br>However, in complicated cases, we may have one program composed of multiple processes(web server).   <em>In web server, the simplist model comprises two processes, one is used for request fetching, another is for local manipulation.</em></p>
<p>Multiprocess is a way to implement <code>concurrency</code>. The major purpose is still to boost the efficiency for using CPU.</p>
<h3 id="Example-of-Web-Server"><a href="#Example-of-Web-Server" class="headerlink" title="Example of Web Server"></a><strong>Example of Web Server</strong></h3><ol>
<li><p>Simplistic Model (Singel Process)<br><em>in single process, scheduler is inactive</em></p>
<pre><code>WebServerProcess&#123;
 forever&#123;
     wait for incoming request #func 1
     read file from disk #
     send file in response # func 2
 &#125;
&#125;
</code></pre>
</li>
<li><p>After Seperation</p>
<pre><code>Listener&#123;
 forever&#123;
     wait for incoming request
     CreateProcess( worker, request ) # activate Worker
 &#125;
&#125;

WorkerProcess(request)&#123;
 read file from disk
 send response
 exit
&#125;
</code></pre>
<p><em>The idea is to create each worker(process) for a corresponding request to enable the scheduler.</em>  </p>
<h4 id="Amount-of-work-on-server-per-request"><a href="#Amount-of-work-on-server-per-request" class="headerlink" title="Amount of work on server per request:"></a><em><strong>Amount of work on server per request:</strong></em></h4><ul>
<li>Receive network packet(request)</li>
<li>Run listner process</li>
<li>Create worker process -&gt; <em>which can be expensive</em></li>
<li>Read file from disk</li>
<li>Send response</li>
</ul>
<p> To solve the creation cost, we can do preprocess( create some(max) workers as initialization ).</p>
<pre><code>Listener&#123;
    for(i=0; i&lt;MAX_PROCESSES; i++) process[i] = CreateProcess(worker)
forever&#123;
    wait for incoming request
    send(request, process[?]) # use Worker
&#125;
&#125;

WorkerProcess[?]&#123;
forever&#123;
wait for message(&amp;request)
read file from disk
send response
exit
&#125;
&#125;
</code></pre>
</li>
</ol>
<h3 id="IPC-Inter-Process-Communication"><a href="#IPC-Inter-Process-Communication" class="headerlink" title="IPC(Inter Process Communication)"></a><strong>IPC(Inter Process Communication)</strong></h3><h4 id="Purpose-1"><a href="#Purpose-1" class="headerlink" title="Purpose:"></a><strong>Purpose</strong>:</h4><p>To communicate the info between processes.</p>
<p>Two ways to implement IPC:</p>
<ul>
<li>message passing<ul>
<li>By value communication</li>
<li>Never by reference -&gt; seperation of msg in sender and receiver</li>
</ul>
</li>
<li>RPC(remote procedural calls)</li>
</ul>
<p>In Web Server, the IPC is implemented in two fields: inside field(communication between worker and listner) and outside field(communication between client and server).<br><em><strong>notice:</strong><br>in web server, the msg passing is not passed by reference but a new copy created instead. (Indicating memory is not shared)<br>in OS, the msg passing is implemented through the kernel.</em></p>
<h4 id="Message-Passing"><a href="#Message-Passing" class="headerlink" title="Message Passing"></a><strong>Message Passing</strong></h4><p>Ways to implement message passing:  </p>
<ul>
<li>Symmetric Addressing</li>
<li>Asymmetric Addressing</li>
<li>Blocking Receive</li>
<li>Nonblocking Receive</li>
</ul>
<p> <em>Example of asymmetric addressing:</em></p>
<pre><code>  Listener&#123;
      for(i=0; i&lt;MAX_PROCESSES; i++) process[i] = CreateProcess(worker)
  forever&#123;
      client_pid = receive(msg) #receive from any client(always asymmetric)
      msg&#39; = modified msg including client_pid
      send (msg&#39;, worker_process[?])
  &#125;
 &#125;

 WorkerProcess[?]&#123;
  forever&#123;
  receive(msg)
  read file from disk
  send (response, client_pid)
  &#125;
 &#125;
</code></pre>
<p><em>More examples please refer to the lecture</em></p>
<h4 id="RPC-Remote-Procedural-Call"><a href="#RPC-Remote-Procedural-Call" class="headerlink" title="RPC(Remote Procedural Call)"></a><strong>RPC(Remote Procedural Call)</strong></h4><p><code>RPC is based on message passing</code></p>
<h5 id="Purpose-2"><a href="#Purpose-2" class="headerlink" title="Purpose"></a><strong>Purpose</strong></h5><p>causes a procedure(function) to execute in a different address space(commonly another computer on a shared network).</p>
<h5 id="RPC-Interface"><a href="#RPC-Interface" class="headerlink" title="RPC Interface"></a><strong>RPC Interface</strong></h5><p>RPC Interface exposes a list of remotely callable procedures, with their signatures(arguments and return values).<br><em><strong><small>Analogy:</small></strong><br>RPC Server &lt;-&gt; Export file system<br>RPC Client &lt;-&gt; Import file system</em><br><em><strong><small>Problem:</small></strong><br>Message passing $\neq$ procedural call</em><br>So How to bridge the gap?<br>Solution: <code>stub library</code></p>
<h5 id="Stub-Library"><a href="#Stub-Library" class="headerlink" title="Stub Library"></a><strong>Stub Library</strong></h5><p><em>client and server stub are generated automatically, and they are part of the application</em>  </p>
<h6 id="Two-message-types"><a href="#Two-message-types" class="headerlink" title="Two message types:"></a><strong>Two message types:</strong></h6><ul>
<li>Call message<ul>
<li>from client to server</li>
<li>contains argument</li>
</ul>
</li>
<li>Return message<ul>
<li>from server to client</li>
<li>contains return values</li>
</ul>
</li>
</ul>
<h6 id="Mechanism"><a href="#Mechanism" class="headerlink" title="Mechanism:"></a><strong>Mechanism:</strong></h6><p>Client process communicate with server process through RPC interface(which implementing stub library, the stubs are generated automatically through the <code>compiler</code>).</p>
<ol>
<li>Clinet proc call clinet stub</li>
<li>client stub goes to kernel and pass the call message</li>
<li>server stub receive from kernel</li>
<li>server get proc call and execute</li>
</ol>
<h6 id="Message-Format"><a href="#Message-Format" class="headerlink" title="Message Format:"></a><strong>Message Format:</strong></h6><p>Message needs to include not only the basic arguments(pid,arg0,…) but which procedure is called.</p>
<blockquote>
<p><strong>Notice</strong><br>The mechanism of RPC indicates it’s very inefficient to implement it. SO CAREFUL THINKING BEFORE IMPLEMENT IT.</p>
</blockquote>
<h4 id="How-does-this-work"><a href="#How-does-this-work" class="headerlink" title="How does this work?"></a><strong>How does this work?</strong></h4><p>Automatic stub generation:</p>
<ul>
<li>rpcbind<br>universal addresses to RPC program number mapper <pre><code>sudo apt_get install rpcbind
</code></pre>
</li>
<li>rpcgen<br>tool generating remote program interface modules</li>
</ul>
<h3 id="IPC-x2F-LPC-x2F-RPC"><a href="#IPC-x2F-LPC-x2F-RPC" class="headerlink" title="IPC&#x2F;LPC&#x2F;RPC"></a>IPC&#x2F;LPC&#x2F;RPC</h3><p>Reference: <a target="_blank" rel="noopener" href="https://blog.csdn.net/Cmm_CSDN/article/details/86138330">https://blog.csdn.net/Cmm_CSDN/article/details/86138330</a></p>
<p>进程间通信（IPC，Inter-Process Communication）：<br>指至少两个进程或线程间传送数据或信号的一些技术或方法。进程是计算机系统分配资源的最小单位。每个进程都有自己的一部分独立的系统资源，彼此是隔离的。为了能使不同的进程互相访问资源并进行协调工作，才有了进程间通信。这些进程可以运行在同一计算机上或网络连接的不同计算机上。 进程间通信技术包括消息传递、同步、共享内存和远程过程调用。 IPC是一种标准的Unix通信机制。</p>
<p>有两种类型的进程间通信（IPC）：  </p>
<ol>
<li>本地过程调用（LPC  Local Procedure Call）：<br>LPC用在多任务操作系统中，使得同时运行的任务能互相会话。这些任务共享内存空间使任务同步和互相发送信息。</li>
<li>远程过程调用（RPC  Reomote Procedure Call）：<br>特指一种隐藏了过程调用时实际通信细节的IPC方法。客户端将调用一个本地方法，而这个本地方法则是负责透明的与远程服务端进行过程间通信。这个本地方法会讲相关参数顺序打包到一个消息中，然后把这个消息发送给服务端提供的方法，服务端的方法会从消息中解出序列化发出来的参数，然后执行，最后仍以同样的方式将方法的返回值发送给客户端</li>
</ol>
<p> LPC和RPC都属于远程同步过程调用，远程的意思是指跨越进程边界进行调用，包括本机进程间调用和跨越机器边界的调用。本来只需要一个RPC就足够了，它同时可用于进行本机调用和网络调用，但由于网络调用的复杂性，微软发明了一套只用于本机跨进程调用的机制（专利产品）就是LPC。由于LPC不涉及网络控制，因此大大简化了远程调用的流程，也提高了调用效率，当RPC用于网络调用时，RPC还是RPC，当RPC用于本机调用时，实际上执行的是LPC，系统自动判断的。LPC在操作系统中无处不在，很多API都使用了LPC，尤其是那些需要在内核态和用户态之间切换的调用全部使用了LPC。</p>

            
        </div>
    </div>
    <div class="post-tags">
        
        <span class="icon">
            <i class="fa-solid fa-tags fa-fw"></i>
        </span>
        
        
        <span class="tag">
            
            <a href="/tags/Lecture-Notes/" style="color: #00bcd4">
                Lecture Notes
            </a>
        </span>
        
        <span class="tag">
            
            <a href="/tags/Operating-System/" style="color: #ffa2c4">
                Operating System
            </a>
        </span>
        
    </div>
    <a href="/2023/03/03/COMP310-multiprocesscom/" class="go-post">阅读全文</a>
</div>

<div class="post">
    <a href="/2023/03/01/Markdown-Guide/">
        <h2 class="post-title">Markdown Guide</h2>
    </a>
    <div class="category-and-date">
        
        <span class="category">
            <a href="/categories/Guide/">
                <span class="icon">
                    <i class="fa-solid fa-bookmark fa-fw"></i>
                </span>
                Guide
            </a>
        </span>
        
        <span class="date">
            <span class="icon">
                <i class="fa-solid fa-calendar fa-fw"></i>
            </span>
            2023/3/1
        </span>
        
        
    </div>
    <div class="description">
        <div class="content" v-pre>
            
            
            
        </div>
    </div>
    <div class="post-tags">
        
        <span class="icon">
            <i class="fa-solid fa-tags fa-fw"></i>
        </span>
        
        
        <span class="tag">
            
            <a href="/tags/Markdown/" style="color: #ffa2c4">
                Markdown
            </a>
        </span>
        
    </div>
    <a href="/2023/03/01/Markdown-Guide/" class="go-post">阅读全文</a>
</div>

<div class="post">
    <a href="/2023/02/26/Stanford-CS142-C1-HTML/">
        <h2 class="post-title">Stanford_CS142_W1_HTML</h2>
    </a>
    <div class="category-and-date">
        
        <span class="category">
            <a href="/categories/Lecture-Notes/">
                <span class="icon">
                    <i class="fa-solid fa-bookmark fa-fw"></i>
                </span>
                Lecture Notes
            </a>
        </span>
        
        <span class="date">
            <span class="icon">
                <i class="fa-solid fa-calendar fa-fw"></i>
            </span>
            2023/2/26
        </span>
        
        
    </div>
    <div class="description">
        <div class="content" v-pre>
            
            <h1 id="CS-142-W1-1-HTML"><a href="#CS-142-W1-1-HTML" class="headerlink" title="CS 142 _ W1_1_HTML"></a>CS 142 _ W1_1_HTML</h1><p><em>This document is singly a lecture  notes for CS 142 and act as a review for basic markdown syntax.</em></p>
<p><strong>Markup Language</strong>:<br>Include directives with content. Is an example of <code>declarative language</code>.<br>The Major purpose for using markup language can be disected into many aspects, but one use can be to focus on the content of the text per se, instead of its formation.<br><em>Two examples of markup langages: Markdown, HTML</em></p>
<p><strong>HTML</strong>(HyperText Markup Language)<br>As noted above, HTML is a type of markup language.<br>Approach for writing HTML:</p>
<ol>
<li>start with contents to be displayed</li>
<li>annotate it with tags</li>
</ol>
<p><strong>HTML Tags:</strong><br>HTML tags provide:  </p>
<ol>
<li>Meaning of text:<ul>
<li><code>&lt;h1&gt;</code> means top-level heading</li>
<li><code>&lt;p&gt;</code> means paragraph</li>
<li><code>&lt;ul&gt; &lt;li&gt;</code> for unordered(bulleted) list</li>
</ul>
</li>
<li>Formatting information(properties of the contents)</li>
<li>Additional information to display(e.g.<code>&lt;img&gt;</code>)</li>
</ol>
<p><em>Tags nestation are supported</em></p>
<p><strong>XHTML(XML-Based HTML)</strong><br>Difference:</p>
<ol>
<li>XHTML is more strict about adhering to proper syntax<ul>
<li>do not ignore unknown tags</li>
<li>do not carry on with syntax errors</li>
<li>do not guess the character missing</li>
</ul>
</li>
</ol>
<p><strong>Basic Syntax of XHTML:</strong><br>Document: hierarchical collection of elements, starting with <code>&lt;html&gt;</code></p>
<ul>
<li>Elements: start tag, contents, end tag  <ul>
<li>start tags can contain <em>attributes</em></li>
</ul>
</li>
</ul>
<p><a href="/2023/02/26/Stanford-CS142-C1-HTML/test_1.html" title="only for test purpose">A test html site.</a><br>&lt;–The document would be renewed in 2023&#x2F;2&#x2F;26 UTC-5–&gt;</p>

            
        </div>
    </div>
    <div class="post-tags">
        
        <span class="icon">
            <i class="fa-solid fa-tags fa-fw"></i>
        </span>
        
        
        <span class="tag">
            
            <a href="/tags/HTML/" style="color: #ff7d73">
                HTML
            </a>
        </span>
        
        <span class="tag">
            
            <a href="/tags/web-development/" style="color: #00a596">
                web development
            </a>
        </span>
        
    </div>
    <a href="/2023/02/26/Stanford-CS142-C1-HTML/" class="go-post">阅读全文</a>
</div>

<div class="post">
    <a href="/2023/02/25/Let-s-begin/">
        <h2 class="post-title">Let&#39;s begin</h2>
    </a>
    <div class="category-and-date">
        
        <span class="category">
            <a href="/categories/test/">
                <span class="icon">
                    <i class="fa-solid fa-bookmark fa-fw"></i>
                </span>
                test
            </a>
        </span>
        
        <span class="date">
            <span class="icon">
                <i class="fa-solid fa-calendar fa-fw"></i>
            </span>
            2023/2/25
        </span>
        
        
    </div>
    <div class="description">
        <div class="content" v-pre>
            
            <p><strong>it only represents a single test to the publishing functionality to this blog.</strong><br>LaTex Test:<br>\LaTex Basic Math Functionality<br>$$ x + y &#x3D; \sum^{\infty}_{k&#x3D;1}y^k $$</p>

            
        </div>
    </div>
    <div class="post-tags">
        
        <span class="icon">
            <i class="fa-solid fa-tags fa-fw"></i>
        </span>
        
        
        <span class="tag">
            
            <a href="/tags/test/" style="color: #00bcd4">
                test
            </a>
        </span>
        
    </div>
    <a href="/2023/02/25/Let-s-begin/" class="go-post">阅读全文</a>
</div>

<div class="post">
    <a href="/2023/02/25/hello-world/">
        <h2 class="post-title">Hello World</h2>
    </a>
    <div class="category-and-date">
        
        <span class="date">
            <span class="icon">
                <i class="fa-solid fa-calendar fa-fw"></i>
            </span>
            2023/2/25
        </span>
        
        
    </div>
    <div class="description">
        <div class="content" v-pre>
            
            <p>Welcome to <a target="_blank" rel="noopener" href="https://hexo.io/">Hexo</a>! This is your very first post. Check <a target="_blank" rel="noopener" href="https://hexo.io/docs/">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a target="_blank" rel="noopener" href="https://hexo.io/docs/troubleshooting.html">troubleshooting</a> or you can ask me on <a target="_blank" rel="noopener" href="https://github.com/hexojs/hexo/issues">GitHub</a>.</p>
<h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><pre><code class="bash">$ hexo new &quot;My New Post&quot;
</code></pre>
<p>More info: <a target="_blank" rel="noopener" href="https://hexo.io/docs/writing.html">Writing</a></p>
<h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><pre><code class="bash">$ hexo server
</code></pre>
<p>More info: <a target="_blank" rel="noopener" href="https://hexo.io/docs/server.html">Server</a></p>
<h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><pre><code class="bash">$ hexo generate
</code></pre>
<p>More info: <a target="_blank" rel="noopener" href="https://hexo.io/docs/generating.html">Generating</a></p>
<h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><pre><code class="bash">$ hexo deploy
</code></pre>
<p>More info: <a target="_blank" rel="noopener" href="https://hexo.io/docs/one-command-deployment.html">Deployment</a></p>

            
        </div>
    </div>
    <div class="post-tags">
        
        
    </div>
    <a href="/2023/02/25/hello-world/" class="go-post">阅读全文</a>
</div>


            <div class="page-current">
    <div class="prev">
        
    </div>
    <div class="page-index">
        
        <span class="current">1</span>
        
    </div>
    <div class="next">
        
    </div>
</div>

        </div>
    </div>
    
    <div id="home-card">
        <div id="card-div">
    <div class="card-style" style="width: 300px">
        <div class="avatar">
            <img src="/images/OIP.jpg" alt="avatar">
        </div>
        <div class="name">Terrance</div>
        <div class="description">
            <p>Honor Mathematics &amp; Honor Econ &amp; Honor CS</p>

        </div>
        
        
    </div>
</div>

    </div>
    
</div>

                <footer id="footer">
    <div class="footer-wrap">
        <div>
            &copy;
            2023 - 2023 Aubade_Blog
            <span class="footer-icon">
                <i class="fa-solid fa-font-awesome fa-fw"></i>
            </span>
            &commat;Terrance
        </div>
        <div>Based on the <a target="_blank" rel="noopener" href="https://hexo.io">Hexo Engine</a> &amp; <a target="_blank" rel="noopener" href="https://github.com/argvchs/hexo-theme-particlex">ParticleX Theme</a></div>
        
    </div>
</footer>

            </div>
            </transition>
            <div id="showimg">
                <img id="showimg-content">
            </div>
        </div>
        <script src="/js/functions.js"></script>
<script src="/js/particlex.js"></script>


    </body>
</html>
